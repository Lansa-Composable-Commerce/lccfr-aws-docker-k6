name: Build and Deploy

on:
  push:
    branches:
      - main
    tags:
      - "*"

permissions:
  contents: write
  packages: write

env:
  IMAGE_NAME: ghcr.io/dylanrmrz/lccfr-aws-docker-k6
  NODE_ENV: production
  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
  AWS_REGION: us-east-2
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  SECRET_KEY_USER_PAYLOAD: ${{ secrets.SECRET_KEY_USER_PAYLOAD }}
  SECRET_KEY_ACCESS_TOKEN: ${{ secrets.SECRET_KEY_ACCESS_TOKEN }}
  SECRET_KEY_REFRESH_TOKEN: ${{ secrets.SECRET_KEY_REFRESH_TOKEN }}
  JWT_ACCESS_TOKEN_KEY: ${{ secrets.JWT_ACCESS_TOKEN_KEY }}
  JWT_REFRESH_TOKEN_KEY: ${{ secrets.JWT_REFRESH_TOKEN_KEY }}
  NEXT_PUBLIC_CENEXT_URL: ${{ secrets.NEXT_PUBLIC_CENEXT_URL }}
  JWT_SECRET_KEY: ${{ secrets.JWT_SECRET_KEY }}
  NEXT_PUBLIC_APP_URL: ${{ secrets.NEXT_PUBLIC_APP_URL }}
  NEXT_LOCALE: ${{ secrets.NEXT_LOCALE }}
  NEXT_PUBLIC_BUYER_TYPE: ${{ secrets.NEXT_PUBLIC_BUYER_TYPE }}
  ECS_CLUSTER: ${{ secrets.ECS_CLUSTER }}
  ECS_SERVICE: ${{ secrets.ECS_SERVICE }}
  TASK_FAMILY: ${{ secrets.TASK_FAMILY }}
  INFLUXDB_USER: "admin"
  INFLUXDB_PASS: "admin123"
  INFLUXDB_URL: "18.218.182.112:8086"
  INFLUXDB_DB: "mydb"

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    outputs:
      full_image: ${{ steps.vars.outputs.full_image }}
    steps:
      - name: Bump version based on commit message
        id: bump
        shell: bash
        run: |
          echo "Test cleaned workflow actions"
